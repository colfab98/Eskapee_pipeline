// === Offline-safe, SLURM-ready config for nf-core/bacass 2.3.1 ===

params {
  // Offline-friendly: skip DB-heavy modules and non-essentials
  skip_kraken2    = true
  skip_kmerfinder = true
  skip_multiqc    = true
  skip_fastqc     = true
  skip_pycoqc     = true
  skip_quast      = true

  // nf-core template param (harmless if unused)
  monochromeLogs  = false

  // Unicycler custom flags (0.5.x): set to '' or a real string, not null
  unicycler_args  = ''
}

process {
  // Use SLURM everywhere
  executor = 'slurm'

  // Forward custom args into every Unicycler step
  withName: /.*UNICYCLER.*/ {
    ext.args = "${params.unicycler_args}"
  }

  // Make non-critical bits non-blocking
  withName: 'NFCORE_BACASS:BACASS:NANOPLOT' {
    errorStrategy = 'ignore'
    maxRetries    = 0
    cpus          = 2
    memory        = 2.GB
  }
  withName: /.*VERSIONS.*/ {
    errorStrategy = 'ignore'
    maxRetries    = 0
  }
  withName: /.*NFCORE_PIPELINE_SUMMARY.*/ {
    errorStrategy = 'ignore'
    maxRetries    = 0
  }

  // Global default: gentle retry
  errorStrategy = 'retry'
  maxRetries    = 1

  withName: /.*QUAST.*/ {
    env.MPLBACKEND     = 'Agg'
    env.PYTHONWARNINGS = 'ignore'
    cpus = 4
    memory = 8.GB
    time = '8h'
    errorStrategy = 'retry'
    maxRetries = 1
  }

  withName: 'NFCORE_BACASS:BACASS:MULTIQC_CUSTOM' {
    errorStrategy = 'ignore'
    maxRetries    = 0
    // prevent environment resolution to avoid mamba touching the net
    conda         = null
  }

  withName: /.*MULTIQC.*/ {
    errorStrategy = 'ignore'
    maxRetries    = 0
  }

}

// Optional SLURM executor tuning (safe defaults)
executor {
  name            = 'slurm'
  queueSize       = 64
  submitRateLimit = '5 sec'
  pollInterval    = '30 sec'
}

// Give Unicycler more juice on sv3000 (adjust if needed)
process {
  withName: /NFCORE_BACASS:BACASS:UNICYCLER.*/ {
    cpus   = 12
    memory = 64.GB
  }
}

// Avoid startup aborts if these already exist from a previous attempt
trace    { overwrite = true }
timeline { overwrite = true }
report   { overwrite = true }

process {
  withName: 'NFCORE_FETCHNGS:SRA:SRA_FASTQ_FTP' {
    memory = 2.GB      // or 4.GB
    time   = '24h'
    cpus   = 1
    errorStrategy = 'retry'
    maxRetries    = 5
  }
}
